<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Speed of Light – Solar System to Scale</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1" />
  <style>
    :root {
      color-scheme: dark;
    }

    body {
      margin: 0;
      background: #050816;
      color: #eee;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
    }

    #app {
      display: flex;
      flex-direction: column;
      height: 100vh;
      width: 100vw;
    }

    .section {
      padding: 8px 16px 4px;
      background: #050816;
      font-size: 15px;
      font-weight: 500;
      color: #ddd;
    }

    canvas {
      display: block;
      width: 100%;
    }

    #bottomPanel {
      padding: 14px 16px 18px;
      background: #040b18;
      border-top: 1px solid #222;
    }

    #controlsRow {
      display: flex;
      flex-wrap: wrap;
      gap: 12px;
      align-items: center;
    }

    .btn {
      appearance: none;
      border: 1.5px solid #4a5cff;
      background: #151b33;
      color: #eee;
      border-radius: 6px;
      padding: 8px 14px;
      font-size: 13px;
      cursor: pointer;
      min-width: 180px;
      text-align: center;
    }

    .btn.restart {
      border-color: #ff6666;
    }

    #infoText {
      margin-top: 10px;
      font-size: 12px;
      color: #ccc;
      max-width: 720px;
      line-height: 1.4;
    }

    #statusLine {
      margin-top: 8px;
      font-size: 12px;
      color: #aaa;
    }

    @media (max-width: 600px) {
      .btn {
        width: 100%;
      }

      #controlsRow {
        flex-direction: column;
        align-items: stretch;
      }
    }
  </style>
</head>
<body>

<div id="app">
  <div class="section">Sun → Pluto (Distances to Scale — Photon Simulation)</div>
  <canvas id="topCanvas"></canvas>

  <div class="section">Current Hop (Zoomed Segment View)</div>
  <canvas id="middleCanvas"></canvas>

  <div id="bottomPanel">
    <div id="controlsRow">
      <button id="modeButton" class="btn">Mode: Simulated (×60)</button>
      <button id="restartButton" class="btn restart">Restart simulation</button>
    </div>

    <div id="infoText">
      Toggle between real time (×1) and accelerated (×60) simulation.  
      Restart sends the photon back to the Sun (t = 0).
    </div>

    <div id="statusLine">
      Sim time: <span id="simTimeText">0s</span> · 
      Photon distance: <span id="photonDistanceText">0 AU</span> · 
      Current hop: <span id="hopText">—</span>
    </div>
  </div>
</div>

<script>
  const topCanvas = document.getElementById('topCanvas');
  const middleCanvas = document.getElementById('middleCanvas');
  const topCtx = topCanvas.getContext('2d');
  const middleCtx = middleCanvas.getContext('2d');

  function resizeCanvases() {
    const width = window.innerWidth;
    const height = window.innerHeight;

    const topHeight = Math.round(height * 0.33);
    const middleHeight = Math.round(height * 0.33);

    topCanvas.width = width;
    topCanvas.height = topHeight;

    middleCanvas.width = width;
    middleCanvas.height = middleHeight;
  }

  window.addEventListener('resize', resizeCanvases);
  resizeCanvases();

  const AU_KM = 149_597_870;
  const C_KM_S = 299_792;

  const bodies = [
    { name: "Sun",     distanceAu: 0.00 },
    { name: "Mercury", distanceAu: 0.39 },
    { name: "Venus",   distanceAu: 0.72 },
    { name: "Earth",   distanceAu: 1.00 },
    { name: "Mars",    distanceAu: 1.52 },
    { name: "Jupiter", distanceAu: 5.20 },
    { name: "Saturn",  distanceAu: 9.58 },
    { name: "Uranus",  distanceAu: 19.2 },
    { name: "Neptune", distanceAu: 30.1 },
    { name: "Pluto",   distanceAu: 39.5 },
  ];

  const maxDistanceAu = bodies[bodies.length - 1].distanceAu;
  const maxDistanceKm = maxDistanceAu * AU_KM;
  const maxTravelTimeSec = maxDistanceKm / C_KM_S;

  const REAL_TIME_SPEED = 1;
  const FAST_SPEED = 60;

  let simMode  = "simulated";
  let simSpeed = FAST_SPEED;

  let simTimeSec = 0;
  let lastTimestamp = null;

  const modeButton = document.getElementById('modeButton');
  const restartButton = document.getElementById('restartButton');
  const simTimeText = document.getElementById('simTimeText');
  const photonDistanceText = document.getElementById('photonDistanceText');
  const hopText = document.getElementById('hopText');

  modeButton.addEventListener('click', () => {
    if (simMode === "simulated") {
      simMode = "real";
      simSpeed = REAL_TIME_SPEED;
      modeButton.textContent = "Mode: Real Time (×1)";
    } else {
      simMode = "simulated";
      simSpeed = FAST_SPEED;
      modeButton.textContent = "Mode: Simulated (×60)";
    }
  });

  restartButton.addEventListener('click', () => {
    simTimeSec = 0;
    lastTimestamp = null;
  });

  function formatTime(seconds) {
    const s = Math.floor(seconds);
    const h = Math.floor(s / 3600);
    const m = Math.floor((s % 3600) / 60);
    const sec = s % 60;

    if (h) return `${h}h ${m}m ${sec}s`;
    if (m) return `${m}m ${sec}s`;
    return `${sec}s`;
  }

  function lightTimeSeconds(distanceAu) {
    return (distanceAu * AU_KM) / C_KM_S;
  }

  function findCurrentSegment(distanceAu) {
    for (let i = 0; i < bodies.length - 1; i++) {
      const a = bodies[i];
      const b = bodies[i + 1];
      if (distanceAu >= a.distanceAu && distanceAu <= b.distanceAu) {
        const span = b.distanceAu - a.distanceAu || 1;
        return { a, b, t: (distanceAu - a.distanceAu) / span };
      }
    }
    return { a: bodies[bodies.length - 2], b: bodies[bodies.length - 1], t: 1 };
  }

  function drawPlanet(ctx, x, y, label, isSun, isEarth) {
    const r = isSun ? 10 : isEarth ? 6 : 4;
    ctx.beginPath();
    ctx.arc(x, y, r, 0, Math.PI * 2);
    ctx.fillStyle = isSun ? "#ffcc33" : isEarth ? "#66aaff" : "#aaa";
    ctx.fill();
    ctx.fillStyle = "#eee";
    ctx.font = "12px system-ui";
    ctx.textAlign = "center";
    ctx.fillText(label, x, y + r + 4);
  }

  function drawPhoton(ctx, x, y) {
    ctx.beginPath();
    ctx.arc(x, y, 5, 0, Math.PI * 2);
    ctx.shadowColor = "#00ffff";
    ctx.shadowBlur = 12;
    ctx.fillStyle = "#00ffff";
    ctx.fill();
    ctx.shadowBlur = 0;
  }

  function drawTop(ctx, w, h, photonDistanceAu) {
    ctx.fillStyle = "#050816";
    ctx.fillRect(0, 0, w, h);

    const marginX = 60;
    const y = h * 0.5;
    const x0 = marginX;
    const x1 = w - marginX;
    const span = x1 - x0;

    ctx.strokeStyle = "#444";
    ctx.lineWidth = 2;
    ctx.beginPath();
    ctx.moveTo(x0, y);
    ctx.lineTo(x1, y);
    ctx.stroke();

    for (const b of bodies) {
      const x = x0 + (b.distanceAu / maxDistanceAu) * span;
      drawPlanet(ctx, x, y, b.name, b.name === "Sun", b.name === "Earth");
    }

    const frac = Math.min(photonDistanceAu / maxDistanceAu, 1);
    const photonX = x0 + frac * span;
    drawPhoton(ctx, photonX, y);
  }

  function drawMiddle(ctx, w, h, photonDistanceAu) {
    ctx.fillStyle = "#030311";
    ctx.fillRect(0, 0, w, h);

    const marginX = 60;
    const y = h * 0.5;
    const x0 = marginX;
    const x1 = w - marginX;

    ctx.strokeStyle = "#555";
    ctx.lineWidth = 2;
    ctx.beginPath();
    ctx.moveTo(x0, y);
    ctx.lineTo(x1, y);
    ctx.stroke();

    const { a, b, t } = findCurrentSegment(photonDistanceAu);

    drawPlanet(ctx, x0, y, a.name, a.name === "Sun", a.name === "Earth");
    drawPlanet(ctx, x1, y, b.name, b.name === "Sun", b.name === "Earth");

    const photonX = x0 + t * (x1 - x0);
    drawPhoton(ctx, photonX, y);

    hopText.textContent = `${a.name} → ${b.name}`;
  }

  function loop(ts) {
    if (lastTimestamp == null) lastTimestamp = ts;
    const dt = (ts - lastTimestamp) / 1000;
    lastTimestamp = ts;

    simTimeSec += dt * simSpeed;
    if (simTimeSec > maxTravelTimeSec) simTimeSec = 0;

    const photonKm = C_KM_S * simTimeSec;
    const photonAu = photonKm / AU_KM;

    drawTop(topCtx, topCanvas.width, topCanvas.height, photonAu);
    drawMiddle(middleCtx, middleCanvas.width, middleCanvas.height, photonAu);

    simTimeText.textContent = formatTime(simTimeSec);
    photonDistanceText.textContent = photonAu.toFixed(2) + " AU";

    requestAnimationFrame(loop);
  }

  requestAnimationFrame(loop);
</script>
</body>
</html>
